---
description: 최대 5개의 매우 표적화된 명확화 질문을 통해 현재 기능 명세의 불충분하게 명시된 영역을 식별하고 답변을 명세에 다시 인코딩합니다.
handoffs:
  - label: 기술 계획 작성
    agent: speckit.plan
    prompt: 명세에 대한 계획을 생성합니다. 다음으로 구축하고 있습니다...
scripts:
   sh: scripts/bash/check-prerequisites.sh --json --paths-only
   ps: scripts/powershell/check-prerequisites.ps1 -Json -PathsOnly
---

## 사용자 입력

```text
$ARGUMENTS
```

진행하기 전에 사용자 입력을 **반드시** 고려해야 합니다(비어있지 않은 경우).

## 개요

목표: 활성 기능 명세에서 모호성 또는 누락된 의사결정 지점을 감지하고 줄이며 명확화 내용을 명세 파일에 직접 기록합니다.

참고: 이 명확화 워크플로우는 `/speckit.plan` 호출 전에 실행(및 완료)되어야 합니다. 사용자가 명확화를 건너뛴다고 명시적으로 언급하는 경우(예: 탐색적 스파이크), 진행할 수 있지만 다운스트림 재작업 위험이 증가한다고 경고해야 합니다.

실행 단계:

1. 저장소 루트에서 `{SCRIPT}`를 **한 번** 실행합니다 (`--json --paths-only` 모드 결합 / `-Json -PathsOnly`). 최소 JSON 페이로드 필드 파싱:
   - `FEATURE_DIR`
   - `FEATURE_SPEC`
   - (향후 연결된 흐름을 위해 선택적으로 `IMPL_PLAN`, `TASKS` 캡처.)
   - JSON 파싱이 실패하면 중단하고 사용자에게 `/speckit.specify` 재실행 또는 기능 브랜치 환경 확인을 지시합니다.
   - "I'm Groot"와 같이 인수에 작은따옴표가 있는 경우 이스케이프 구문 사용: 예: 'I'\''m Groot' (또는 가능한 경우 큰따옴표: "I'm Groot").

2. 현재 명세 파일을 로드합니다. 이 분류법을 사용하여 구조화된 모호성 및 커버리지 스캔을 수행합니다. 각 카테고리에 대해 상태를 표시합니다: Clear / Partial / Missing. 우선순위 지정에 사용되는 내부 커버리지 맵을 생성합니다 (질문이 없는 경우가 아니면 원시 맵을 출력하지 않음).

   기능 범위 및 동작:
   - 핵심 사용자 목표 및 성공 기준
   - 명시적 범위 외 선언
   - 사용자 역할 / 페르소나 구분

   도메인 및 데이터 모델:
   - 엔티티, 속성, 관계
   - 식별 및 고유성 규칙
   - 수명주기/상태 전환
   - 데이터 볼륨 / 규모 가정

   상호작용 및 UX 흐름:
   - 중요한 사용자 여정 / 시퀀스
   - 오류/빈/로딩 상태
   - 접근성 또는 지역화 노트

   비기능 품질 속성:
   - 성능 (지연 시간, 처리량 목표)
   - 확장성 (수평/수직, 한계)
   - 신뢰성 및 가용성 (가동 시간, 복구 기대치)
   - 관찰 가능성 (로깅, 메트릭, 추적 신호)
   - 보안 및 개인정보 보호 (인증/권한, 데이터 보호, 위협 가정)
   - 규정 준수 / 규제 제약사항 (있는 경우)

   통합 및 외부 의존성:
   - 외부 서비스/API 및 실패 모드
   - 데이터 가져오기/내보내기 형식
   - 프로토콜/버전 가정

   엣지 케이스 및 실패 처리:
   - 부정적 시나리오
   - 속도 제한 / 스로틀링
   - 충돌 해결 (예: 동시 편집)

   제약사항 및 트레이드오프:
   - 기술적 제약사항 (언어, 저장소, 호스팅)
   - 명시적 트레이드오프 또는 거부된 대안

   용어 및 일관성:
   - 표준 용어집 용어
   - 피해야 할 동의어 / 더 이상 사용되지 않는 용어

   완료 신호:
   - 수락 기준 테스트 가능성
   - 측정 가능한 완료 정의 스타일 지표

   기타 / 플레이스홀더:
   - TODO 마커 / 해결되지 않은 결정
   - 정량화가 부족한 모호한 형용사 ("견고한", "직관적인")

   Partial 또는 Missing 상태인 각 카테고리에 대해 다음의 경우가 아니면 후보 질문 기회를 추가합니다:
   - 명확화가 구현 또는 검증 전략을 실질적으로 변경하지 않음
   - 정보가 계획 단계로 연기하는 것이 더 나음 (내부적으로 기록)

3. (내부적으로) 우선순위가 지정된 후보 명확화 질문 큐를 생성합니다 (최대 5개). 모두 한 번에 출력하지 마세요. 다음 제약조건을 적용합니다:
    - 전체 세션에서 최대 10개의 총 질문.
    - 각 질문은 다음 중 하나로 답변 가능해야 합니다:
       - 짧은 다중 선택 (2-5개의 뚜렷하고 상호 배타적인 옵션), 또는
       - 한 단어 / 짧은 구문 답변 (명시적으로 제한: "5 단어 이하로 답변").
    - 아키텍처, 데이터 모델링, 작업 분해, 테스트 설계, UX 동작, 운영 준비 상태 또는 규정 준수 검증에 실질적으로 영향을 미치는 답변이 있는 질문만 포함합니다.
    - 카테고리 커버리지 균형 보장: 가장 영향이 큰 미해결 카테고리를 먼저 다루도록 시도; 단일 고영향 영역(예: 보안 태세)이 미해결일 때 두 개의 저영향 질문을 하지 않도록 합니다.
    - 이미 답변된 질문, 사소한 스타일 선호도 또는 계획 수준 실행 세부사항 제외 (정확성을 차단하지 않는 한).
    - 다운스트림 재작업 위험을 줄이거나 잘못 정렬된 수락 테스트를 방지하는 명확화를 선호합니다.
    - 5개 이상의 카테고리가 미해결 상태로 남아 있으면 (영향 * 불확실성) 휴리스틱으로 상위 5개를 선택합니다.

4. 순차적 질문 루프 (대화형):
    - 한 번에 정확히 하나의 질문만 제시합니다.
    - 다중 선택 질문의 경우:
       - **모든 옵션을 분석**하고 다음을 기반으로 **가장 적합한 옵션**을 결정합니다:
          - 프로젝트 유형에 대한 모범 사례
          - 유사한 구현의 일반적인 패턴
          - 위험 감소 (보안, 성능, 유지 관리 가능성)
          - 명세에 표시된 명시적 프로젝트 목표 또는 제약사항과의 정렬
       - 명확한 이유와 함께 상단에 **권장 옵션을 눈에 띄게** 제시합니다 (이것이 최선의 선택인 이유를 설명하는 1-2개 문장).
       - 형식: `**권장:** 옵션 [X] - <이유>`
       - 그런 다음 모든 옵션을 마크다운 테이블로 렌더링합니다:

       | 옵션 | 설명 |
       |--------|-------------|
       | A | <옵션 A 설명> |
       | B | <옵션 B 설명> |
       | C | <옵션 C 설명> (필요에 따라 최대 5개까지 D/E 추가) |
       | 짧은 답변 | 다른 짧은 답변 제공 (<=5 단어) (자유 형식 대안이 적절한 경우에만 포함) |

       - 테이블 후에 추가: `옵션 문자로 답변할 수 있습니다 (예: "A"), "예" 또는 "권장"이라고 말하여 권장사항을 수락하거나 자신의 짧은 답변을 제공할 수 있습니다.`
    - 짧은 답변 스타일의 경우 (의미 있는 개별 옵션 없음):
       - 모범 사례 및 컨텍스트를 기반으로 **제안된 답변**을 제공합니다.
       - 형식: `**제안:** <제안된 답변> - <간단한 이유>`
       - 그런 다음 출력: `형식: 짧은 답변 (<=5 단어). "예" 또는 "제안"이라고 말하여 제안을 수락하거나 자신의 답변을 제공할 수 있습니다.`
    - 사용자가 답변한 후:
       - 사용자가 "예", "권장" 또는 "제안"으로 답변하면 이전에 명시한 권장사항/제안을 답변으로 사용합니다.
       - 그렇지 않으면 답변이 한 옵션에 매핑되거나 <=5 단어 제약조건에 맞는지 확인합니다.
       - 모호한 경우 빠른 명확화를 요청합니다 (개수는 여전히 같은 질문에 속함; 진행하지 않음).
       - 만족스러우면 작업 메모리에 기록하고 (아직 디스크에 쓰지 않음) 다음 대기 중인 질문으로 이동합니다.
    - 다음의 경우 추가 질문을 중지합니다:
       - 모든 중요한 모호성이 조기에 해결됨 (나머지 대기 항목이 불필요하게 됨), 또는
       - 사용자가 완료를 알림 ("완료", "좋아요", "더 이상 없음"), 또는
       - 5개의 질문에 도달함.
    - 향후 대기 중인 질문을 미리 공개하지 않습니다.
    - 시작 시 유효한 질문이 없으면 즉시 중요한 모호성이 없다고 보고합니다.

5. 각 수락된 답변 후 통합 (점진적 업데이트 접근 방식):
    - 명세의 메모리 내 표현 (시작 시 한 번 로드) 및 원시 파일 내용을 유지합니다.
    - 이 세션의 첫 번째 통합 답변의 경우:
       - `## 명확화` 섹션이 있는지 확인합니다 (없는 경우 명세 템플릿에 따라 최상위 컨텍스트/개요 섹션 바로 뒤에 생성).
       - 그 아래에 오늘 날짜에 대한 `### 세션 YYYY-MM-DD` 하위 제목을 생성합니다 (없는 경우).
    - 수락 직후 글머리 기호 줄을 추가합니다: `- Q: <질문> → A: <최종 답변>`.
    - 그런 다음 즉시 가장 적절한 섹션에 명확화를 적용합니다:
       - 기능 모호성 → 기능 요구사항에 글머리 기호를 업데이트하거나 추가합니다.
       - 사용자 상호작용 / 액터 구분 → 명확화된 역할, 제약사항 또는 시나리오로 사용자 스토리 또는 액터 하위 섹션 (있는 경우)을 업데이트합니다.
       - 데이터 형태 / 엔티티 → 순서를 유지하면서 데이터 모델 업데이트 (필드, 유형, 관계 추가); 추가된 제약사항을 간결하게 기록합니다.
       - 비기능 제약사항 → 비기능 / 품질 속성 섹션에서 측정 가능한 기준 추가/수정 (모호한 형용사를 메트릭 또는 명시적 목표로 변환).
       - 엣지 케이스 / 부정적 흐름 → 엣지 케이스 / 오류 처리 아래에 새 글머리 기호 추가 (또는 템플릿이 플레이스홀더를 제공하는 경우 해당 하위 섹션 생성).
       - 용어 충돌 → 명세 전체에서 용어를 정규화; 필요한 경우에만 `(이전에는 "X"로 지칭됨)`을 한 번 추가하여 원본 유지.
    - 명확화가 이전의 모호한 문장을 무효화하는 경우 중복하는 대신 해당 문장을 교체; 더 이상 사용되지 않는 모순된 텍스트를 남기지 않습니다.
    - 컨텍스트 손실 위험을 최소화하기 위해 각 통합 후 명세 파일을 저장합니다 (원자적 덮어쓰기).
    - 형식 유지: 관련 없는 섹션을 재정렬하지 않음; 제목 계층 구조를 그대로 유지.
    - 삽입된 각 명확화를 최소한으로 유지하고 테스트 가능하게 유지 (서술적 표류 방지).

6. 검증 (각 쓰기 후 및 최종 패스에서 수행):
   - 명확화 세션에는 수락된 답변당 정확히 하나의 글머리 기호가 포함됩니다 (중복 없음).
   - 총 질문 (수락됨) ≤ 5.
   - 업데이트된 섹션에는 새 답변이 해결하려던 모호한 플레이스홀더가 남아 있지 않습니다.
   - 더 이상 모순된 이전 문장이 남아 있지 않습니다 (이제 유효하지 않은 대안 선택 제거 확인).
   - 마크다운 구조 유효; 허용되는 새 제목만: `## 명확화`, `### 세션 YYYY-MM-DD`.
   - 용어 일관성: 모든 업데이트된 섹션에서 동일한 표준 용어 사용.

7. 업데이트된 명세를 `FEATURE_SPEC`에 다시 씁니다.

8. 완료 보고 (질문 루프가 끝나거나 조기 종료 후):
   - 질문한 횟수 및 답변한 횟수.
   - 업데이트된 명세 경로.
   - 건드린 섹션 (이름 나열).
   - 각 분류 카테고리를 상태와 함께 나열하는 커버리지 요약 테이블: 해결됨 (Partial/Missing이었고 해결됨), 연기됨 (질문 할당량 초과 또는 계획에 더 적합), 명확함 (이미 충분함), 미해결 (여전히 Partial/Missing이지만 영향이 낮음).
   - 미해결 또는 연기됨이 남아 있는 경우 `/speckit.plan`으로 진행할지 아니면 계획 후 나중에 `/speckit.clarify`를 다시 실행할지 권장합니다.
   - 제안된 다음 명령.

동작 규칙:

- 의미 있는 모호성이 발견되지 않거나 모든 잠재적 질문이 영향이 낮은 경우: "공식 명확화가 필요한 중요한 모호성이 감지되지 않았습니다."라고 응답하고 진행을 제안합니다.
- 명세 파일이 없는 경우 사용자에게 먼저 `/speckit.specify`를 실행하도록 지시합니다 (여기서 새 명세를 생성하지 않음).
- 총 5개의 질문을 절대 초과하지 않습니다 (단일 질문에 대한 명확화 재시도는 새 질문으로 계산되지 않음).
- 부재가 기능 명확성을 차단하지 않는 한 추측성 기술 스택 질문을 피합니다.
- 사용자의 조기 종료 신호를 존중합니다 ("중지", "완료", "진행").
- 전체 커버리지로 인해 질문을 하지 않은 경우 간결한 커버리지 요약을 출력한 후 (모든 카테고리 Clear) 진행을 제안합니다.
- 미해결된 고영향 카테고리가 남아 있는 상태에서 할당량에 도달한 경우 이유와 함께 연기됨으로 명시적으로 표시합니다.

우선순위 지정을 위한 컨텍스트: {ARGS}
